<ng-container [ngTemplateOutlet]="readmode ? readTemplate : editTemplate">
  <ng-template #readTemplate>
    <div class="container container--read" [attr.sma-param-style]="paramStyle">
      @if (label) {
        @switch (paramStyle) {
          @case ('filter') {
            <div class="label-wrapper">
              <span class="label">{{ label }}</span>
              <div class="dashed-row"></div>
            </div>
          }
          @default {
            <span class="label">{{ label }}</span>
            <div class="dashed-row"></div>
          }
        }
      }
      <ng-container [ngTemplateOutlet]="value ? showedValueTemplate : emptyTemplate">
        <ng-template #showedValueTemplate>
          @switch (paramStyle) {
            @case ('filter') {
              <pre class="value">{{ showedValue }}</pre>
            }
            @default {
              <div class="value">
                <span>{{ showedValue }}</span>
              </div>
            }
          }
        </ng-template>
        <ng-template #emptyTemplate>
          <span class="value">-</span>
        </ng-template>
      </ng-container>
    </div>
  </ng-template>
  <ng-template #editTemplate>
    <div class="container container--edit" [attr.sma-param-style]="paramStyle">
      @if (label) {
        <div class="label-wrapper">
          <span class="label" [class.required]="required">
            {{ label }}
          </span>
          @if (hint) {
            <tui-icon
              icon="assets/icons/circle-info-empty.svg"
              [tuiHint]="hint"
              class="hintIcon"
            ></tui-icon>
          }
        </div>
      }
      <tui-textfield
        tuiChevron
        tuiTextfieldSize="m"
        tuiAppearance="sma-input-appearance"
        [stringify]="stringify()"
        [tuiTextfieldCleaner]="forceClear"
        [tuiTextfieldLabelOutside]="true"
        [content]="valueContent"
        (focusin)="isFocused = true"
        (focusout)="isFocused = false"
        (mouseenter)="isHovered = true"
        (mouseleave)="isHovered = false"
      >
        <input tuiComboBox [placeholder]="placeholder()" [formControl]="control" />
        <ng-container *tuiTextfieldDropdown [ngTemplateOutlet]="paramTreeTemplate"></ng-container>
      </tui-textfield>
      <ng-template #valueContent let-list>
        {{ shortPickedLength() ? 'Выбрано: ' : null }} {{ list.length }}
      </ng-template>
    </div>
  </ng-template>
</ng-container>

<ng-template #paramTreeTemplate>
  <sma-param-tree
    [multi]="true"
    [checkedNodes]="checkedNodes()"
    (selectedNodesChange)="setSelectedNodes($event)"
  ></sma-param-tree>
</ng-template>
