<ng-container [ngTemplateOutlet]="readmode ? readTemplate : editTemplate">
  <ng-template #readTemplate>
    <div class="container container--read" [attr.sproc-param-style]="paramStyle">
      @if (label) {
        <ng-container [ngSwitch]="paramStyle">
          <ng-template ngSwitchCase="filter">
            <div class="label-wrapper">
              <span class="label">{{ label }}</span>
              <div class="dashed-row"></div>
            </div>
          </ng-template>
          <ng-template ngSwitchDefault>
            <span class="label">{{ label }}</span>
            <div class="dashed-row"></div>
          </ng-template>
        </ng-container>
      }
      <div class="value">
        <span>{{ showedValue }}</span>
      </div>
    </div>
  </ng-template>
  <ng-template #editTemplate>
    <div class="container container--edit" [attr.sproc-param-style]="paramStyle">
      <div *ngIf="label" class="label-wrapper" [class.applied]="applied()">
        <span class="label" [class.required]="required">
          {{ label }}
        </span>
      </div>

      @if (searchable) {
        <tui-textfield
          tuiTextfieldSize="m"
          tuiAppearance="sproc-input-appearance"
          tuiChevron
          [tuiTextfieldCleaner]="true"
          [tuiHint]="value && showedValue !== '-' ? hintContent : undefined"
          [content]="valueTemplate"
        >
          <input
            (input)="search$.next($any($event.target).value)"
            tuiComboBox
            [strict]="strict()"
            [placeholder]="placeholder()"
            [formControl]="control"
          />

          <tui-loader [showLoader]="loading" [overlay]="true">
            <tui-data-list-wrapper
              new
              *tuiTextfieldDropdown
              [items]="items | tuiFilterByInput: matcher()"
              [itemContent]="listItemTemplate ?? dropdownOptionContent"
              [tuiDropdownMaxHeight]="maxDropdownHeight"
              (itemClick)="onSelect.emit($event)"
            />
          </tui-loader>

          <ng-container *ngTemplateOutlet="textfieldIcons"></ng-container>
        </tui-textfield>
      } @else {
        <tui-textfield
          tuiTextfieldSize="m"
          tuiAppearance="sproc-input-appearance"
          tuiChevron
          [tuiTextfieldLabelOutside]="true"
          [tuiTextfieldCleaner]="true"
          [tuiHint]="value && showedValue !== '-' ? hintContent : undefined"
          [content]="valueTemplate"
          [tuiDropdownMaxHeight]="maxDropdownHeight"
        >
          <input tuiSelect [placeholder]="placeholder()" [formControl]="control" />

          <tui-loader [showLoader]="loading" [overlay]="true">
            <tui-data-list-wrapper
              new
              *tuiTextfieldDropdown
              [items]="items"
              [itemContent]="listItemTemplate ?? dropdownOptionContent"
              (itemClick)="onSelect.emit($event)"
            />
          </tui-loader>

          <ng-container *ngTemplateOutlet="textfieldIcons"></ng-container>
        </tui-textfield>
      }
      <ng-template #dropdownOptionContent let-data>
        <div>
          {{ stringify()(data) }}
        </div>
      </ng-template>

      <ng-template #hintContent> {{ showedValue }} </ng-template>

      <ng-template #textfieldIcons>
        <div class="textfield-icons-container">
          @if (isInvalidAndNotPristine) {
            <sproc-param-invalid-icon></sproc-param-invalid-icon>
          }
        </div>
      </ng-template>
    </div>
  </ng-template>
</ng-container>
